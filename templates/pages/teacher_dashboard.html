{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard Gi√°o vi√™n{% endblock %}

{% block extra_css %}
<style>
    /* Card th·ªëng k√™ ki·ªÉu m·ªõi */
    .stat-card {
        background: #fff;
        border: 1px solid #eef2f6;
        border-radius: 12px;
        padding: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        border-color: transparent;
    }
    
    /* Icon box m√†u m√® */
    .icon-box {
        width: 48px; height: 48px;
        border-radius: 10px;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 15px;
    }
    .icon-red { background: #fff5f5; color: #e53e3e; }
    .icon-orange { background: #fffaf0; color: #dd6b20; }
    .icon-blue { background: #ebf8ff; color: #3182ce; }
    .icon-green { background: #f0fff4; color: #38a169; }

    /* B·∫£ng ƒë·ªÅ thi */
    .card-table {
        border: 1px solid #eef2f6;
        border-radius: 12px;
        overflow: hidden;
        background: #fff;
    }
    .table th {
        background: #f8fafc;
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #64748b;
        font-weight: 600;
        padding: 12px 20px;
    }
    .table td {
        padding: 15px 20px;
        vertical-align: middle;
        color: #334155;
    }
    
    /* N√∫t t√°c v·ª• nhanh */
    .quick-link {
        display: flex;
        align-items: center;
        padding: 12px;
        border-radius: 8px;
        color: #475569;
        text-decoration: none;
        transition: background 0.2s;
    }
    .quick-link:hover {
        background: #f1f5f9;
        color: var(--primary-color);
    }
    .quick-link i { font-size: 1.2rem; margin-right: 10px; }
</style>
{% endblock %}

{% block content %}
<!-- Ch√†o m·ª´ng -->
<div class="d-flex justify-content-between align-items-end mb-4 mt-2">
    <div>
        <h5 class="text-muted fw-normal mb-1">Ch√†o m·ª´ng tr·ªü l·∫°i,</h5>
        <h2 class="fw-bold mb-0 text-dark">{{ user.username }}! üëã</h2>
    </div>
    <div>
        <button class="btn btn-white border bg-white shadow-sm text-muted fw-bold">
            <i class="bi bi-calendar-event me-2"></i>{% now "d/m/Y" %}
        </button>
    </div>
</div>

<!-- H√†ng Th·ªëng k√™ (C√≥ m√†u s·∫Øc nh∆∞ y√™u c·∫ßu) -->
<div class="row g-3 mb-4">
    <!-- Card 1 -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card h-100">
            <div class="d-flex justify-content-between">
                <div>
                    <h6 class="text-uppercase text-muted small fw-bold">Ng√¢n h√†ng c√¢u h·ªèi</h6>
                    <h2 class="fw-bold mb-0 mt-2">{{ total_questions }}</h2>
                </div>
                <div class="icon-box icon-red">
                    <i class="bi bi-stack"></i>
                </div>
            </div>
            <span class="badge bg-light text-muted mt-2 border">Total</span>
        </div>
    </div>
    
    <!-- Card 2 -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card h-100">
            <div class="d-flex justify-content-between">
                <div>
                    <h6 class="text-uppercase text-muted small fw-bold">ƒê·ªÅ thi ƒë√£ t·∫°o</h6>
                    <h2 class="fw-bold mb-0 mt-2">{{ total_quizzes }}</h2>
                </div>
                <div class="icon-box icon-orange">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
            </div>
            <a href="{% url 'quiz:quiz_list' %}" class="small text-decoration-none fw-bold text-warning mt-2 d-block">
                Xem chi ti·∫øt <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>

    <!-- Card 3 -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card h-100">
            <div class="d-flex justify-content-between">
                <div>
                    <h6 class="text-uppercase text-muted small fw-bold">L∆∞·ª£t tham gia</h6>
                    <h2 class="fw-bold mb-0 mt-2">{{ total_attempts }}</h2>
                </div>
                <div class="icon-box icon-blue">
                    <i class="bi bi-people-fill"></i>
                </div>
            </div>
            <span class="badge bg-light text-muted mt-2 border">H·ªçc sinh</span>
        </div>
    </div>

    <!-- Card 4 -->
    <div class="col-xl-3 col-md-6">
        <div class="stat-card h-100">
            <div class="d-flex justify-content-between">
                <div>
                    <h6 class="text-uppercase text-muted small fw-bold">T·ªâ l·ªá ƒë√∫ng TB</h6>
                    <h2 class="fw-bold mb-0 mt-2">{{ average_correct_rate }}%</h2>
                </div>
                <div class="icon-box icon-green">
                    <i class="bi bi-graph-up-arrow"></i>
                </div>
            </div>
            <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar bg-success" style="width: {{ average_correct_rate }}%"></div>
            </div>
        </div>
    </div>
</div>

<!-- Layout 2 C·ªôt: Danh s√°ch & T√°c v·ª• -->
<div class="row g-4">
    
    <!-- C·ªòT TR√ÅI: Danh s√°ch ƒë·ªÅ thi -->
    <div class="col-lg-8">
        <div class="card card-table h-100 shadow-sm border-0">
            <div class="card-header bg-white py-3 px-4 border-bottom d-flex justify-content-between align-items-center">
                <h6 class="fw-bold mb-0">ƒê·ªÅ thi g·∫ßn ƒë√¢y</h6>
                <a href="{% url 'quiz:quiz_list' %}" class="btn btn-sm btn-outline-secondary rounded-pill px-3">Xem t·∫•t c·∫£</a>
            </div>
            <div class="table-responsive">
                <table class="table mb-0">
                    <thead>
                        <tr>
                            <th>T√™n ƒë·ªÅ thi</th>
                            <th>M√¥n h·ªçc</th>
                            <th>Th·ªùi l∆∞·ª£ng</th>
                            <th>Ng√†y t·∫°o</th>
                            <th class="text-end">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for quiz in recent_quizzes %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="bg-light rounded p-2 text-danger me-3">
                                        <i class="bi bi-file-text-fill"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">{{ quiz.title|truncatechars:25 }}</div>
                                        <div class="small text-muted">{{ quiz.questions.count }} c√¢u h·ªèi</div>
                                    </div>
                                </div>
                            </td>
                            <td><span class="badge bg-light text-dark border fw-normal">{{ quiz.subject.name }}</span></td>
                            <td class="text-muted small"><i class="bi bi-clock me-1"></i>{{ quiz.duration_minutes }}p</td>
                            <td class="text-muted small">{{ quiz.created_at|date:"d/m/Y" }}</td>
                            <td class="text-end">
                                <a href="{% url 'quiz:quiz_edit' quiz.pk %}" class="btn btn-sm btn-white border hover-shadow text-muted">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-5 text-muted">
                                Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÅ thi n√†o.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- C·ªòT PH·∫¢I: T√°c v·ª• nhanh -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-4">
                <h6 class="fw-bold mb-3">T√°c v·ª• nhanh</h6>
                
                <a href="{% url 'quiz:quiz_create' %}" class="btn btn-danger w-100 py-2 mb-3 shadow-sm fw-bold">
                    <i class="bi bi-plus-lg me-2"></i>T·∫°o ƒë·ªÅ thi m·ªõi
                </a>

                <div class="border-top pt-3">
                    <small class="text-uppercase text-muted fw-bold" style="font-size: 0.7rem;">Qu·∫£n l√Ω</small>
                    <div class="mt-2">
                        <a href="{% url 'quiz:question_list' %}" class="quick-link">
                            <i class="bi bi-stack text-primary"></i>
                            <div>
                                <div class="fw-bold text-dark" style="font-size: 0.9rem;">Ng√¢n h√†ng c√¢u h·ªèi</div>
                                <div class="small text-muted" style="font-size: 0.75rem;">Qu·∫£n l√Ω kho d·ªØ li·ªáu</div>
                            </div>
                        </a>
                        
                        <a href="{% url 'quiz:question_import' %}" class="quick-link">
                            <i class="bi bi-file-earmark-spreadsheet text-success"></i>
                            <div>
                                <div class="fw-bold text-dark" style="font-size: 0.9rem;">Import Excel</div>
                                <div class="small text-muted" style="font-size: 0.75rem;">Th√™m h√†ng lo·∫°t</div>
                            </div>
                        </a>

                        <a href="{% url 'quiz:grading_dashboard' %}" class="quick-link">
                            <i class="bi bi-check-circle text-warning"></i>
                            <div>
                                <div class="fw-bold text-dark" style="font-size: 0.9rem;">Ch·∫•m b√†i t·ª± lu·∫≠n</div>
                                <div class="small text-muted" style="font-size: 0.75rem;">ƒê√°nh gi√° b√†i l√†m</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}